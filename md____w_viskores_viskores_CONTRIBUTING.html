<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Viskores: Contributing to Viskores</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Viskores
   &#160;<span id="projectnumber">0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Contributing to Viskores </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We are currently in the process of adopting software from [VTK-m]. During this transitional period, we have no formal method of accepting contributions outside of our core contributors. For the time being, new contributions should be directed at the <a href="https://m.vtk.org">VTK-m</a> project.</p>
<p>When Viskores is ready to accept its own features, the contributing process will be similar to <a href="https://gitlab.kitware.com/vtk/vtk-m/-/blob/main/CONTRIBUTING.md">that of VTK-m's</a>.</p>
<p>The author of all contributions must agree to the [Developer Certificate of Origin] sign-off. Any developer who submits a contribution to Viskores implicitly agrees to these conditions. That said, contributors remain as the copyright holder for independent works of authorship and that no contributor or copyright holder will be required to assign copyrights to Viskores.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Requirements</h1>
<p>This page documents how to develop Viskores through <a href="http://git-scm.com">Git</a>.</p>
<p>Git is an extremely powerful version control tool that supports many different "workflows" for individual development and collaboration. Here we document procedures used by the Viskores development community. In the interest of simplicity and brevity we do <em>not</em> provide an explanation of why we use this approach.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Setup</h1>
<p>Before you begin, perform initial setup:</p>
<ol type="1">
<li>Create an account in <a href="https://github.com">GitHub</a> and select a user name.</li>
<li><a href="https://github.com/Viskores/viskores/fork">Fork Viskores</a> into your user's namespace on <a href="https://github.com">GitHub</a>.</li>
<li><p class="startli">Use Git to create a local clone of the main VTK repository: </p><pre class="fragment">$ git clone git@github.com:viskores/viskores.git
$ cd viskores
</pre><p class="startli">The main repository will be configured as your <code>origin</code> remote.</p>
</li>
<li>Run the developer setup script to prepare your Viskores work tree and create Git command aliases used below: <pre class="fragment">$ ./Utilities/SetupForDevelopment.sh
</pre></li>
<li>(Optional but highly recommended.) Install the official <a href="https://cli.github.com/">GitHub CLI utility</a> on your developing station. This tool greatly simplifies interacting with GitHub from the command line.</li>
<li>(Optional but highly recommended.) <a href="https://open.cdash.org/register">Register with the Viskores dashboard</a> on Kitware's CDash instance to better know how your code performs in regression tests. After registering and signing in, click on "All Dashboards" link in the upper left corner, scroll down and click "Subscribe to this project" on the right of Viskores.</li>
<li>(Optional but highly recommended.) <a href="https://github.com/Viskores/viskores/discussions">Join us in the Viskores discussions</a> to communicate with other developers and users.</li>
</ol>
<h1><a class="anchor" id="autotoc_md12"></a>
Workflow</h1>
<p>Viskores development uses a <a href="http://public.kitware.com/Wiki/Git/Workflow/Topic">branchy workflow</a> based on topic branches. Our collaboration workflow consists of three main steps:</p>
<ol type="1">
<li>Local Development:<ul>
<li><a href="#update">Update</a></li>
<li><a href="#create-a-topic">Create a Topic</a></li>
</ul>
</li>
<li>Code Review (requires [GitHub Access]):<ul>
<li><a href="#share-a-topic">Share a Topic</a></li>
<li><a href="#create-a-merge-request">Create a pull request</a></li>
<li><a href="#review-a-merge-request">Review a pull request</a></li>
<li><a href="#reformat-a-topic">Reformat a Topic</a></li>
<li><a href="#revise-a-topic">Revise a Topic</a></li>
</ul>
</li>
<li>Integrate Changes:<ul>
<li><a href="#merge-a-topic">Merge a Topic</a> (requires permission in GitHub)</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md13"></a>
Update</h1>
<ol type="1">
<li>Update your local <code>main</code> branch: <pre class="fragment">$ git checkout main
$ git pull
</pre></li>
<li>Optionally push <code>main</code> to your fork in GitHub: <pre class="fragment">$ git push github main
</pre></li>
</ol>
<h1><a class="anchor" id="autotoc_md14"></a>
Create a Topic</h1>
<p>All new work must be committed on topic branches. Name topics like you might name functions: concise but precise. A reader should have a general idea of the feature or fix to be developed given just the branch name.</p>
<ol type="1">
<li>To start a new topic branch: <pre class="fragment">$ git fetch origin
</pre></li>
<li>For new development, start the topic from <code>origin/main</code>: <pre class="fragment">$ git checkout -b my-topic origin/main
</pre></li>
<li><p class="startli">Edit files and create commits (repeat as needed): </p><pre class="fragment">$ edit file1 file2 file3
$ git add file1 file2 file3
$ git commit
</pre><p class="startli">Caveats:</p><ul>
<li>Data files must be placed under a folder explicitly named 'data' at the root level in the source directory. This is required as Viskores uses a git submodule to efficiently support data files.</li>
</ul>
</li>
<li>If you are adding a new feature or making significant changes to API, make sure to add a entry to <code>docs/changelog</code>. This allows release notes to properly capture all relevant changes.</li>
</ol>
<h2><a class="anchor" id="autotoc_md15"></a>
Guidelines for Commit Messages</h2>
<p>Remember to <em>motivate &amp; summarize</em>. When writing commit messages. Get into the habit of creating messages that have enough information for any developer to read and glean relevant information such as:</p>
<ol type="1">
<li>Is this change important and why?</li>
<li>If addressing an issue, which issue(s)?</li>
<li>If a new feature, why is it useful and/or necessary?</li>
<li>Are there background references or documentation?</li>
</ol>
<p>A short description of what the issue being addressed and how will go a long way towards making the log more readable and the software more maintainable. Viskores requires that your message start with a single subject line, followed by a blank line, followed by the message body which contains the more detailed explanatory text for the commit. You can consider a commit message to very similar to an email with the first line being the subject of an email and the rest of the text as the body.</p>
<p>Style guidelines for commit messages are as follows:</p>
<ol type="1">
<li>Separate subject from body with a blank line</li>
<li>Limit the subject line to 78 characters</li>
<li>Capitalize the subject line</li>
<li>Use the imperative mood in the subject line e.g. "Refactor foo" or "Fix Issue #12322", instead of "Refactoring foo", or "Fixing issue
     #12322".</li>
<li>Wrap the body at 80 characters</li>
<li>Use the body to explain <code>what</code> and <code>why</code> and if applicable a brief <code>how</code>.</li>
</ol>
<h1><a class="anchor" id="autotoc_md16"></a>
Share a Topic</h1>
<p>When a topic is ready for review and possible inclusion, share it by pushing to a fork of your repository in GitHub. Be sure you have registered and signed in for [GitHub Access] and created your fork by visiting the main <a href="https://github.com/viskores/viskores">Viskores GitHub</a> repository page and using the "Fork" button in the upper right.</p>
<ol type="1">
<li>Checkout the topic if it is not your current branch: <pre class="fragment">$ git checkout my-topic
</pre></li>
<li><p class="startli">Push commits in your topic branch to your fork in GitHub: </p><pre class="fragment">$ git push -u github
</pre><p class="startli">Notes:</p><ul>
<li>If you are revising a previously pushed topic and have rewritten the topic history, add <code>-f</code> or <code>--force</code> to overwrite the destination.</li>
<li>If you have created or modified data files (inside the <code>data/</code> directory), you will need to push them separately by opening a pull request at <a href="https://github.com/viskores/viskores-data">https://github.com/viskores/viskores-data</a>.</li>
</ul>
<p class="startli">The output will include a link to the topic branch in your fork in GitHub and a link to a page for creating a pull request.</p>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md17"></a>
Create a pull request</h1>
<p>When you <a href="#share-a-topic">pushed your topic branch</a>, it will provide you with a url of the form </p><pre class="fragment">https://github.com/&lt;username&gt;/viskores/pull/new/&lt;branch_name&gt;
</pre><p>You can copy/paste that into your web browser to create a new merge request. Alternately, you can visit your fork in GitHub, browse to the "**pull requests**" link on the left, and use the "**New pull request**" button in the upper right.</p>
<p>Once at the create pull request page, follow these steps. Many of these will be filled out for you.</p>
<ol type="1">
<li>In the "**Source branch**" box select the <code>&lt;username&gt;/viskores</code> repository and the <code>my-topic</code> branch.</li>
<li>In the "**Base branch**" box select the <code>viskores/viskores</code> repository and the <code>main</code> branch. It should be the default.</li>
<li>Use the "**Compare branches**" button to proceed to the next page and fill out the pull request creation form.</li>
<li><p class="startli">In the "**Title**" field provide a one-line summary of the entire topic. This will become the title of the pull request.</p>
<p class="startli">Example pull request Title: </p><pre class="fragment">Add OpenMP Device Adapter
</pre></li>
<li><p class="startli">In the "**Description**" field provide a high-level description of the change the topic makes and any relevant information about how to try it.</p><ul>
<li>Use <code>@username</code> syntax to draw attention of specific developers. This syntax may be used anywhere outside literal text and code blocks. Or, wait until the <a href="#review-a-merge-request">next step</a> and add comments to draw attention of developers.</li>
<li>Optionally use a fenced code block with type <code>message</code> to specify text to be included in the generated merge commit message when the topic is <a href="#merge-a-topic">merged</a>.</li>
</ul>
<p class="startli">Example pull request Description: </p><pre class="fragment">This branch adds a new device adapter that uses new OpenMP 4+ features
including Task groups to better handle unbalanced and irregular domains

```message
Add a OpenMP 4+ task-based device adapter.
```

Cc: @user1 @user2
</pre></li>
<li>The "**Assign to**", "**Milestone**", and "**Labels**" fields may be left blank.</li>
<li>Enable the "** Allow edits and access to secrets by maintainers.**" option, so that reviewers can modify the pull request. This allows reviewers to change minor style issues without overwhelming the author with change requests.</li>
</ol>
<ol type="1">
<li>Use the "**Open pull request**" button to create the pull request and visit its page.</li>
</ol>
<h2><a class="anchor" id="autotoc_md18"></a>
Guidelines for pull requests</h2>
<p>Remember to <em>motivate &amp; summarize</em>. When creating a pull request, consider the reviewers and future users of the software. Provide enough information to motivate the pull request such as:</p>
<ol type="1">
<li>Is this pull request important and why?</li>
<li>If addressing an issue, which issue(s)?</li>
<li>If a new feature, why is it useful and/or necessary?</li>
<li>Are there background references or documentation?</li>
</ol>
<p>Also provide a summary statement expressing what you did and if there is a choice in implementation or design pattern, the rationale for choosing a certain path. Notable software or data features should be mentioned as well.</p>
<p>A well written pull request will motivate your reviewers, and bring them up to speed faster. Future software developers will be able to understand the reasons why something was done, and possibly avoid chasing down dead ends, Although it may take you a little more time to write a good merge request, youâ€™ll likely see payback in faster reviews and better understood and maintainable software.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
Review a pull request</h1>
<p>Add comments mentioning specific developers using <code>@username</code> syntax to draw their attention and have the topic reviewed. After typing <code>@</code> and some text, GitHub will offer completions for developers whose real names or user names match.</p>
<p>Comments use <a href="https://github.github.com/gfm/">GitHub Flavored Markdown</a> for formatting. See GitHub documentation on <a href="https://docs.github.com/en/issues/tracking-your-work-with-issues/using-issues/linking-a-pull-request-to-an-issue">Special GitHub References</a> to add links to things like pull requests and commits in other repositories.</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Reviews</h2>
<p>Reviewers may add comments providing feedback or to acknowledge their approval. All comments use the <a href="https://github.github.com/gfm/">GitHub Flavored Markdown</a>.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
Fetching Changes</h3>
<p>One may fetch the changes associated with a pull request by using either using the <code>gh pr checkout</code> command line shown at the top of the pull request page or by manually using <code>git fetch</code> to fetch the git head of the pull request as shown below: </p><pre class="fragment">$ git fetch origin pull/$branch/head
</pre><p>This updates the local <code>FETCH_HEAD</code> to refer to the branch.</p>
<p>There are a few options for checking out the changes in a work tree:</p>
<ul>
<li><p class="startli">One may checkout the branch: </p><pre class="fragment">$ git checkout FETCH_HEAD -b $branch
</pre><p class="startli">or checkout the commit without creating a local branch: </p><pre class="fragment">$ git checkout FETCH_HEAD
</pre></li>
<li>Or, one may cherry-pick the commits to minimize rebuild time: <pre class="fragment">$ git cherry-pick ..FETCH_HEAD
</pre></li>
</ul>
<h2><a class="anchor" id="autotoc_md22"></a>
Testing</h2>
<p>Each time a pull request is created or updated automated testing is automatically triggered, and shows up under the pipeline tab.</p>
<p>Developers can track the status of the pipeline for a merge request by using the Pipeline tab on a pull request or by clicking on stage icons as shown below:</p>
<p><img src="docs/build_stage.png" alt="alt text" title="Pipeline" class="inline"/></p>
<p>When trying to diagnose why a build or tests stage has failed it generally is easier to look at the pruned information reported on <a href="https://open.cdash.org/index.php?project=VISKORES">Viskores's CDash Dashboard</a>. To make it easier to see only the results for a given pull request you can click the <code>cdash</code> link under the external stage ( rightmost pipeline stage icon )</p>
<p><img src="docs/external_stage.png" alt="alt text" title="CDash Link" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md23"></a>
Revise a Topic</h1>
<p>Revising a topic is a special way to modify the commits within a topic. Normally during a review of a pull request a developer will resolve issues brought up during review by adding more commits to the topic. While this is sufficient for most issues, some issues can only be resolved by rewriting the history of the topic.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
Starting Revisions</h2>
<p>Regardless of what revisions need to be made, you first must make sure that your topic is the current branch. To make your topic branch current: </p><pre class="fragment">$ git checkout my-topic
</pre><p>(As always, you can get the current branch with the <code>git status</code> command.)</p>
<p>A common need for revisions is to update your topic branch to the latest version of Viskores. Even if you a revising your topic branch for some other reason, also updating to the latest main is usually not a bad idea. To update to the latest commit in main, you need to make sure that the latest commit is in your local repository. To do that run </p><pre class="fragment">$ git pull-main
</pre><h2><a class="anchor" id="autotoc_md25"></a>
Make Local Revisions</h2>
<p>The easiest way to make changes to the commits on your topic branch is to rebase it to the main branch: </p><pre class="fragment">$ git rebase -i main
</pre><p>When you run this command, git will open your text editor with a list of all the commits that will be changed. The first word of each lines indicates a command for that commit. By default, all commits are <code>pick</code>ed, which means that they will be simply passed without change.</p>
<p>If you need to revise the commit message of one of the commits, then replace <code>pick</code> with <code>reword</code> (or just <code>r</code>). When the rebase starts, a new editor will be provided to let you change the commit message.</p>
<p>If you need to make changes to files within a commit, then replace <code>pick</code> with <code>edit</code> (or just <code>e</code>). When the rebase gets to this commit, it will pause to let you make changes to the files.</p>
<p>If you need to merge commits together, use the <code>squash</code> (or <code>s</code>) command. The rebase will give you a change to edit the commit message of the merged commit.</p>
<p>Once you exit your editor, the rebase will begin. If you have requested to edit any commits or if git detects a conflict while applying a commit, it will stop running so that you can make changes. Make the changes you need, use <code>git add</code> to stage those changes, and then use </p><pre class="fragment">$ git rebase --continue
</pre><p>to have git continue the rebase process. You can always run <code>git status</code> to get help about what to do next.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
Push to GitHub</h2>
<p>To push commits in your topic branch to your fork in GitHub: </p><pre class="fragment">$ git push -f
</pre><p>Note: You need have the <code>-f</code> or <code>--force</code> to overwrite the destination as you are revising a previously pushed topic and have rewritten the topic history.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Merge a Topic</h1>
<p>After a topic has been reviewed and approved in a GitHub pull request, authorized developers may accept the pull request and merge clicking the merge button.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Merge Success</h2>
<p>If the merge succeeds the topic will appear in the upstream repository <code>main</code> branch and the pull request will be closed automatically.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Merge Failure</h2>
<p>If the merge fails (likely due to a conflict), a comment will be added describing the failure. In the case of a conflict, fetch the latest upstream history and rebase on it: </p><pre class="fragment">$ git fetch origin
$ git rebase origin/main
</pre><p>Return to the <a href="#share-a-topic">above step</a> to share the revised topic.</p>
<h1><a class="anchor" id="autotoc_md30"></a>
Fixing Problems</h1>
<p>There are a lot of instructions in this document, and if you are not familiar with contributing to Viskores, you may get your repository in a bad state that will cause problems with the other instructions. This section attempts to capture common problems contributors have and the fixes for them.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Wrong origin Remote</h2>
<p>The Viskores contribution workflow assumes that your <code>origin</code> remote is attached to the main Viskores GitHub repository. If it is not, that will cause problems with updating your repository. To check which remote repository origin refers to, run </p><pre class="fragment">$ git remote -v
</pre><p>It will give you a list of remotes and their URLs that you have configured. If you have a line like </p><pre class="fragment">origin  https://github.com/viskores/viskores.git (fetch)
</pre><p>or </p><pre class="fragment">origin  git@github.com:viskores/viskores.git (fetch)
</pre><p>then everything is OK. If it is anything else (for example, it has your GitHub username in it), then you have a problem. Fortunately, you can fix it by simply changing the remote's URL: </p><pre class="fragment">$ git remote set-url origin https://github.com/Viskores/viskores.git
</pre><h2><a class="anchor" id="autotoc_md32"></a>
main Not Tracking origin</h2>
<p>The instructions in this document assume that your <code>main</code> branch is tracking the remote <code>main</code> branch at <code>origin</code> (which, as specified above, should be the main Viskores repository). This should be set up if you correctly cloned the main Viskores repository, but can get accidentally changed.</p>
<p>To check which remote branch <code>main</code> is tracking, call </p><pre class="fragment">$ git rev-parse --abbrev-ref --symbolic-full-name main@{upstream}
</pre><p>Git should respond with <code>origin/main</code>. If it responds with anything else, you need to reset the tracking: </p><pre class="fragment">$ git branch -u origin/main main
</pre><h2><a class="anchor" id="autotoc_md33"></a>
Local Edits on the main Branch</h2>
<p>The first step in the <a href="#workflow">contributing workflow</a> is that you <a href="#create-a-topic">create a topic branch</a> on which to make changes. You are not supposed to add your commits directly to <code>main</code>. However, it is easy to forget to create the topic branch.</p>
<p>To find out if you have local commits on your main branch, check its status: </p><pre class="fragment">$ git checkout main
$ git status
</pre><p>If status responds that your branch is up to date or that your branch is <em>behind</em> the <code>origin/main</code> remote branch, then everything is fine. (If your branch is behind you might want to update it with <code>git pull</code>.)</p>
<p>If the status responds that your branch and <code>origin/main</code> have diverged or that your branch is <em>ahead</em> of <code>origin/main</code>, then you have local commits on the main branch. Those local commits need to move to a topic branch.</p>
<ol type="1">
<li><p class="startli">Create a topic branch: </p><pre class="fragment">$ git branch my-topic
</pre><p class="startli">Of course, replace <code>my-topic</code> with something that better describes your changes.</p>
</li>
<li>Reset the local main branch to the remote main branch: <pre class="fragment">$ git reset --hard origin/main
</pre></li>
<li>Check out the topic branch to continue working on it: <pre class="fragment">$ git checkout my-topic
</pre> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
